# 當日照片分類統計功能說明

## 功能概述

新增「當日照片分類統計」組件到日報表頁面，用於顯示選擇日期的照片縮圖和標籤分類統計。

## 主要功能

### 1. 照片統計顯示
- 顯示當日照片總數
- 按標籤分類統計照片數量
- 顯示各標籤的數量和顏色標識

### 2. 照片縮圖預覽
- 以網格形式顯示最多9張照片縮圖
- 照片上顯示標籤覆蓋層
- 支援點擊查看大圖
- 超過9張照片時顯示「查看全部」按鈕

### 3. 操作功能
- 點擊單張照片：導航到照片詳細頁面
- 點擊「查看全部照片」：導航到照片頁面並過濾當日照片
- 顯示當日照片總大小統計

## 技術實作

### 前端組件
- **組件路徑**: `web/src/app/site-list/site-detail/site-daily-report/daily-photo-stats/daily-photo-stats.component.ts`
- **選擇器**: `app-daily-photo-stats`
- **輸入參數**: `selectedDate` (字串格式 YYYY-MM-DD)

### 後端 API
新增兩個 GridFS API 端點：

1. **照片搜索 API**
   - **端點**: `POST /api/gridfs/search`
   - **功能**: 根據查詢條件搜索照片
   - **輸入**: JSON 查詢條件 (MongoDB 查詢語法)
   - **輸出**: 符合條件的照片陣列

2. **照片檔案取得 API**
   - **端點**: `GET /api/gridfs/file/:id?thumbnail=true`
   - **功能**: 根據檔案ID取得照片內容，支援縮圖功能
   - **參數**: 
     - `id`: 照片檔案ID
     - `thumbnail=true`: 產生150x150縮圖 (使用 sharp 套件)

### 照片頁面增強
修改照片頁面支援查詢參數：
- `startDate`: 起始日期過濾
- `endDate`: 結束日期過濾
- `photoId`: 指定照片ID (預留功能)

## 使用方式

### 在日報表中使用
```html
<app-daily-photo-stats [selectedDate]="selectedDate"></app-daily-photo-stats>
```

### 查詢條件範例
```typescript
// 搜索當日照片的查詢條件
const query = {
  'metadata.siteId': 'site123',
  'contentType': { $regex: '^image/' },
  'uploadDate': {
    $gte: '2024-01-15T00:00:00.000Z',
    $lte: '2024-01-15T23:59:59.999Z'
  }
};
```

## 功能特色

### 1. 響應式設計
- 支援不同螢幕尺寸
- 照片網格自動調整
- 行動裝置友善

### 2. 效能優化
- 縮圖功能減少載入時間
- 懶載入圖片
- 限制顯示照片數量避免過度載入

### 3. 使用者體驗
- 載入狀態提示
- 圖片載入失敗時顯示預設圖示
- 平滑的 hover 效果
- 清楚的操作按鈕

### 4. 標籤系統整合
- 顯示照片標籤統計
- 支援系統預設標籤和自訂標籤
- 標籤顏色視覺化

## 錯誤處理

1. **網路錯誤**: 顯示錯誤訊息並記錄到控制台
2. **照片載入失敗**: 顯示預設圖示
3. **無照片資料**: 顯示友善的空狀態訊息

## 後續擴展可能

1. 實作自動定位到指定照片功能
2. 新增照片批量操作
3. 支援照片快速標籤編輯
4. 新增照片上傳功能整合 