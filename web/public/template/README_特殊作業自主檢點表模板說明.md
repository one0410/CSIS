# 特殊作業工安自主檢點表 Word 模板說明

## 概述

特殊作業工安自主檢點表系統支援10種不同的作業類型，每種作業類型都有對應的Word模板檔案。當用戶選擇不同的作業類型並生成Word文檔時，系統會自動選擇對應的模板。

## 作業類型與模板檔案對應表

| 作業類型 | 模板檔案 |
|---------|---------|
| 動火作業 | `ee-4404-03 特殊作業工安自主檢點表(動火作業) .doc` |
| 高架作業 | `ee-4404-03 特殊作業工安自主檢點表(高架作業).doc` |
| 局限空間作業 | `ee-4404-03 特殊作業工安自主檢點表(局限空間作業).doc` |
| 電力作業 | `ee-4404-03 特殊作業工安自主檢點表(電力作業) .doc` |
| 吊籠作業 | `ee-4404-03 特殊作業工安自主檢點表(吊籠作業) .doc` |
| 起重吊掛作業 | `ee-4404-03 特殊作業工安自主檢點表(起重吊掛作業).doc` |
| 施工架組裝作業 | `ee-4404-03 特殊作業工安自主檢點表(施工架組裝作業).doc` |
| 管線拆裝作業 | `ee-4404-03 特殊作業工安自主檢點表(管線拆離作業).doc` |
| 開口作業 | `ee-4404-03 特殊作業工安自主檢點表(開口作業) .doc` |
| 化學作業 | `ee-4404-03 特殊作業工安自主檢點表(化學作業) .doc` |

## 模板佔位符

每個Word模板都支援以下佔位符，系統會根據表單資料自動填充：

### 基本資訊
- `{projectNo}` - 作業單位
- `{factoryArea}` - 廠區
- `{location}` - 施工地點
- `{applyDate}` - 檢查日期
- `{applyDateYear}` - 檢查年份
- `{applyDateMonth}` - 檢查月份  
- `{applyDateDay}` - 檢查日期
- `{workType}` - 作業類型

### 檢點項目
- `{items}` - 檢點項目結果物件（包含各項目代碼對應的狀態：正常/異常/不適用）
- `{fixes}` - 異常改善措施物件（包含各項目代碼對應的改善措施）
- `{itemInputs}` - 額外輸入欄位資料（如施工人數、時間等）

### 時間記錄
- `{preWorkCheckTime}` - 施工前檢點時間
- `{postWorkCheckTime}` - 收工前檢點時間

### 簽名圖片
- `{%preWorkSupervisorSignature}` - 施工前監工簽名
- `{%preWorkWorkerSignature}` - 施工前作業人員簽名
- `{%postWorkSupervisorSignature}` - 收工前監工簽名
- `{%postWorkWorkerSignature}` - 收工前作業人員簽名

### 其他
- `{remarks}` - 備註

## 使用方式

1. **表單填寫**：用戶在網頁中選擇作業類型並填寫檢點項目
2. **保存表單**：點擊「儲存」按鈕保存表單資料
3. **下載Word**：保存成功後，「下載Word」按鈕會出現
4. **自動選擇模板**：系統根據選擇的作業類型自動選擇對應的Word模板
5. **資料填充**：系統將表單資料填充到模板中的佔位符
6. **生成下載**：生成完整的Word檔案並自動下載

## 檔案命名規則

下載的Word檔案命名格式：
```
特殊作業工安自主檢點表_{作業類型}_{工地名稱}_{檢查日期}_{表單ID前8碼}.docx
```

例如：
```
特殊作業工安自主檢點表_動火作業_南科專案_2024-01-15_abc12345.docx
```

## 注意事項

1. **必須選擇作業類型**：下載Word前必須先選擇作業類型，否則無法確定使用哪個模板
2. **模板檔案完整性**：確保對應的模板檔案存在於 `/template/` 目錄中
3. **簽名圖片**：支援 base64 格式的簽名圖片嵌入
4. **檢點項目動態性**：不同作業類型有不同的檢點項目，模板需要對應設計
5. **輸入欄位支援**：部分檢點項目包含額外的輸入欄位（如施工人數、時間等）

## 技術實作

系統使用 `DocxTemplateService.generateSpecialWorkChecklistDocx()` 方法：
1. 根據 `workType` 選擇對應模板
2. 使用 `docxtemplater` 填充資料
3. 支援 `docxtemplater-image-module-free` 處理簽名圖片
4. 自動生成並下載完整的Word文檔

## 擴展說明

如需新增作業類型：
1. 在 `workTypes` 陣列中添加新的作業類型
2. 創建對應的Word模板檔案
3. 在 `getSpecialWorkTemplateePath()` 方法中添加對應的模板路徑
4. 在 `workTypeCheckItems` 中定義該作業類型的檢點項目 