<nav
  id="menuDiv"
  class="bg-white h-100"
  style="width: 250px; min-width: 250px; overflow-y: auto;"
  aria-label="主要導航選單"
>
  <div class="p-3">
    <!-- 右上角關閉按鈕 -->
    <button
      class="btn btn-sm btn-outline-secondary float-end d-lg-none"
      (click)="closeMenu()"
      title="關閉選單"
      aria-label="關閉選單"
    >
      <i class="fas fa-times" aria-hidden="true"></i>
    </button>
    <!-- 選單標題 -->
    <h2 class="h5">選單</h2>

    <!-- 可收合的選單項目 -->
    <div class="accordion accordion-flush" id="mainMenu">

      <!-- 我的工地 -->
      <section class="accordion-item border-0">
        <h3 class="accordion-header">
          <button class="accordion-button p-2" type="button" data-bs-target="#site-collapse" aria-expanded="true" aria-controls="site-collapse">
            <i class="fas fa-building me-2" aria-hidden="true"></i>我的專案({{currentSite()?.projectName}})
          </button>
        </h3>
        <div id="site-collapse" class="accordion-collapse collapse show">
          <div class="accordion-body p-0">
            <ul class="nav flex-column ps-4" role="menu">
              <!-- 工地詳情選單 -->
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2" [routerLink]="['/site', siteId, 'overview']" routerLinkActive="active" (click)="onNavLinkClick()">專案基本資料</a>
              </li>
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2" [routerLink]="['/site', siteId, 'userList']" routerLinkActive="active" (click)="onNavLinkClick()">專案組織列表</a>
              </li>
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2" [routerLink]="['/site', siteId, 'dashboard']" routerLinkActive="active" (click)="onNavLinkClick()">Dashboard</a>
              </li>
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2" [routerLink]="['/site', siteId, 'new-schedule']" routerLinkActive="active" (click)="onNavLinkClick()">進度管理</a>
              </li>
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2 d-flex justify-content-between align-items-center" [routerLink]="['/site', siteId, 'forms']" routerLinkActive="active" (click)="onNavLinkClick()">
                  <span>工地表單</span>
                  @if (pendingFormsCount() > 0) {
                    <span class="badge bg-warning text-dark" aria-label="待處理表單數量">{{ pendingFormsCount() }}</span>
                  }
                </a>
              </li>
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2" [routerLink]="['/site', siteId, 'bulletin']" routerLinkActive="active" (click)="onNavLinkClick()">工安事項宣導</a>
              </li>

              <!-- 進場管理 - 可收合子選單 -->
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2 d-flex justify-content-between align-items-center"
                   data-bs-toggle="collapse"
                   href="#entryManagementSubmenu"
                   role="button"
                   aria-expanded="false"
                   aria-controls="entryManagementSubmenu">
                  <span class="d-flex align-items-center">
                    進場管理
                    @if (workersWithoutHazardNoticeCount() > 0 || equipmentWarningCount() > 0) {
                      <span class="badge bg-danger ms-2" aria-label="需要注意">!</span>
                    }
                  </span>
                  <i class="fas fa-chevron-down small" aria-hidden="true"></i>
                </a>
                <ul class="collapse nav flex-column ps-3" id="entryManagementSubmenu" role="menu">
                  <li class="nav-item" role="menuitem">
                    <a class="nav-link py-2 d-flex justify-content-between align-items-center" [routerLink]="['/site', siteId, 'workerList']" routerLinkActive="active" (click)="onNavLinkClick()">
                      <span>人才列表</span>
                      @if (workersWithoutHazardNoticeCount() > 0) {
                        <span class="badge bg-danger" aria-label="未完成危害告知人數">{{ workersWithoutHazardNoticeCount() }}</span>
                      }
                    </a>
                  </li>
                  <li class="nav-item" role="menuitem">
                    <a class="nav-link py-2" [routerLink]="['/site', siteId, 'visitorList']" routerLinkActive="active" (click)="onNavLinkClick()">訪客列表</a>
                  </li>
                  <li class="nav-item" role="menuitem">
                    <a class="nav-link py-2" [routerLink]="['/site', siteId, 'hazardNotice']" routerLinkActive="active" (click)="onNavLinkClick()">危害告知</a>
                  </li>
                  <li class="nav-item" role="menuitem">
                    <a class="nav-link py-2 d-flex justify-content-between align-items-center" [routerLink]="['/site', siteId, 'equipment']" routerLinkActive="active" (click)="onNavLinkClick()">
                      <span>機具管理</span>
                      @if (equipmentWarningCount() > 0) {
                        <span class="badge bg-danger" aria-label="需注意機具數量">{{ equipmentWarningCount() }}</span>
                      }
                    </a>
                  </li>
                </ul>
              </li>

              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2" [routerLink]="['/site', siteId, 'photos']" routerLinkActive="active" (click)="onNavLinkClick()">相片管理</a>
              </li>
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2" [routerLink]="['/site', siteId, 'training']" routerLinkActive="active" (click)="onNavLinkClick()">教育訓練管理</a>
              </li>
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2" [routerLink]="['/site', siteId, 'accidentList']" routerLinkActive="active" (click)="onNavLinkClick()">工安通報系統</a>
              </li>

              <!-- 報表相關 - 可收合子選單 -->
              <li class="nav-item" role="menuitem">
                <a class="nav-link py-2 d-flex justify-content-between align-items-center"
                   data-bs-toggle="collapse"
                   href="#reportSubmenu"
                   role="button"
                   aria-expanded="false"
                   aria-controls="reportSubmenu">
                  <span>報表相關</span>
                  <i class="fas fa-chevron-down small" aria-hidden="true"></i>
                </a>
                <ul class="collapse nav flex-column ps-3" id="reportSubmenu" role="menu">
                  <li class="nav-item" role="menuitem">
                    <a class="nav-link py-2" [routerLink]="['/site', siteId, 'daily-report']" routerLinkActive="active" (click)="onNavLinkClick()">日報表</a>
                  </li>
                  <li class="nav-item" role="menuitem">
                    <a class="nav-link py-2" [routerLink]="['/site', siteId, 'weekly-report']" routerLinkActive="active" (click)="onNavLinkClick()">週報表</a>
                  </li>
                  <li class="nav-item" role="menuitem">
                    <a class="nav-link py-2" [routerLink]="['/site', siteId, 'monthly-report']" routerLinkActive="active" (click)="onNavLinkClick()">月報表</a>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </div>
</nav>
