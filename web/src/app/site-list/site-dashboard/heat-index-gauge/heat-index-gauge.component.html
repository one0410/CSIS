<div class="gauge-container">
  <!-- 左側：圖表區域 -->
  <div class="gauge-chart-area">
    <svg viewBox="-10 -10 220 160" class="gauge-svg">
      <!-- 定義文字陰影濾鏡 -->
      <defs>
        <filter id="textShadow" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="#000" flood-opacity="0.8"/>
        </filter>
      </defs>
      <!-- 背景弧形 -->
      <path
        d="M 20 100 A 80 80 0 0 1 180 100"
        fill="none"
        stroke="#1e293b"
        stroke-width="20"
        stroke-linecap="round"
      />

      <!-- 等級弧形 -->
      @for (level of levels; track level.label; let i = $index) {
        <path
          [attr.d]="getArcPath(level, i)"
          fill="none"
          [attr.stroke]="level.color"
          stroke-width="18"
          stroke-linecap="butt"
          class="level-arc"
        />
      }

      <!-- 刻度線 -->
      @for (tick of tickPositions; track tick.value) {
        <line
          [attr.x1]="tick.x1"
          [attr.y1]="tick.y1"
          [attr.x2]="tick.x2"
          [attr.y2]="tick.y2"
          stroke="rgba(255,255,255,0.5)"
          stroke-width="2"
        />
        <text
          [attr.x]="tick.textX"
          [attr.y]="tick.textY"
          fill="#fff"
          font-size="10"
          font-weight="600"
          text-anchor="middle"
          dominant-baseline="middle"
          filter="url(#textShadow)"
        >{{ tick.value | number:'1.1-1' }}</text>
      }

      <!-- 指針 -->
      <g [attr.transform]="'rotate(' + needleRotation + ' 100 100)'">
        <!-- 指針陰影 -->
        <polygon
          points="100,30 96,100 104,100"
          fill="rgba(0,0,0,0.3)"
          transform="translate(2, 2)"
        />
        <!-- 指針本體 -->
        <polygon
          points="100,30 96,100 104,100"
          [attr.fill]="currentLevel?.color || '#64748b'"
          class="needle"
        />
        <!-- 指針中心圓 -->
        <circle cx="100" cy="100" r="12" fill="#1e293b" stroke="#475569" stroke-width="2" />
        <circle cx="100" cy="100" r="6" [attr.fill]="currentLevel?.color || '#64748b'" />
      </g>

      <!-- 數值顯示背景（在半圓形內） -->
      <rect
        x="55"
        y="112"
        width="90"
        height="32"
        rx="8"
        ry="8"
        fill="rgba(15, 23, 42, 0.9)"
      />
      <!-- 數值顯示 -->
      <text
        x="100"
        y="130"
        [attr.fill]="currentLevel?.color || '#64748b'"
        font-size="22"
        font-weight="700"
        text-anchor="middle"
        dominant-baseline="middle"
      >{{ displayHeatIndex | number:'1.1-1' }}</text>
    </svg>
  </div>

  <!-- 右側：資訊區域 -->
  <div class="gauge-info-area">
    <!-- 等級標籤 -->
    <div class="gauge-level" [style.background-color]="currentLevel?.color">
      @if (currentLevel) {
        {{ currentLevel.label }}
      } @else {
        無資料
      }
    </div>

    <!-- 說明 -->
    <div class="gauge-description">
      @if (currentLevel) {
        {{ currentLevel.description }}
      }
    </div>

    <!-- 圖例 -->
    <div class="gauge-legend">
      @for (level of levels; track level.label) {
        <div class="legend-item">
          <span class="legend-color" [style.background-color]="level.color"></span>
          <span class="legend-label text-nowrap">{{ level.label }}</span>
        </div>
      }
    </div>
  </div>
</div>
