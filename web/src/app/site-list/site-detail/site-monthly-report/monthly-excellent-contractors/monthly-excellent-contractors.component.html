<div class="card h-100">
  <div class="card-header">
    <h6 class="mb-0">
      <i class="fas fa-shield-alt me-2"></i>優良廠商
    </h6>
  </div>
  <div class="card-body">
    @if (isLoading()) {
      <div class="text-center py-4">
        <div class="spinner-border spinner-border-sm text-primary me-2" role="status">
          <span class="visually-hidden">載入中...</span>
        </div>
        載入廠商統計中...
      </div>
    } @else {
      <!-- 統計摘要 -->
      <div class="row mb-3">
        <div class="col-4">
          <div class="text-center">
            <div class="fs-4 fw-bold text-primary">{{ totalContractors() }}</div>
            <small class="text-muted">總廠商數</small>
          </div>
        </div>
        <div class="col-4">
          <div class="text-center">
            <div class="fs-4 fw-bold text-success">{{ excellentContractors().length }}</div>
            <small class="text-muted">優良廠商</small>
          </div>
        </div>
        <div class="col-4">
          <div class="text-center">
            <div class="fs-4 fw-bold text-warning">{{ contractorsWithDefects() }}</div>
            <small class="text-muted">有缺失廠商</small>
          </div>
        </div>
      </div>

      <!-- 優良率顯示 -->
      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="text-muted">優良率</span>
          <span class="fw-bold text-success">{{ excellentRate() }}%</span>
        </div>
        <div class="progress" style="height: 8px;">
          <div 
            class="progress-bar bg-success" 
            role="progressbar" 
            [style.width.%]="excellentRate()"
            [attr.aria-valuenow]="excellentRate()"
            aria-valuemin="0" 
            aria-valuemax="100"
          ></div>
        </div>
      </div>

      <!-- 廠商列表 -->
      @if (getContractorStats().length > 0) {
        <div class="contractor-list">
          <h6 class="text-muted mb-2">廠商詳情</h6>
          <div class="contractor-items">
            @for (contractor of getContractorStats(); track contractor.contractorName) {
              <div class="contractor-item d-flex justify-content-between align-items-center py-2 border-bottom">
                <div class="contractor-info">
                  <div class="d-flex align-items-center">
                    @if (contractor.hasDefects) {
                      <i class="fas fa-exclamation-triangle text-warning me-2" title="有缺失記錄"></i>
                    } @else {
                      <i class="fas fa-shield-alt text-success me-2" title="優良廠商"></i>
                    }
                    <span class="fw-medium">{{ contractor.contractorName }}</span>
                  </div>
                  <small class="text-muted">工人數: {{ contractor.totalWorkers }}</small>
                </div>
                <div class="contractor-status text-end">
                  @if (contractor.hasDefects) {
                    <span class="badge bg-warning text-dark">
                      {{ contractor.defectCount }} 缺失
                    </span>
                  } @else {
                    <span class="badge bg-success">優良</span>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      } @else {
        <div class="alert alert-info mb-0">
          <i class="fas fa-info-circle me-2"></i>
          本月無廠商資料
        </div>
      }
    }
  </div>
</div> 