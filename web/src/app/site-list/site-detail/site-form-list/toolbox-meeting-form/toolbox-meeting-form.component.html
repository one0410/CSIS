<div class="container-fluid bg-light min-vh-100 p-3">
  <div class="card form-card shadow-sm">
    <div class="card-body p-4">
      <!-- 實際表單內容容器 -->
      <div class="print-content">
        <!-- 表單頭部 -->
        <app-site-form-header title="工具箱會議及巡檢紀錄"></app-site-form-header>

      <!-- 說明文字 -->
      <div class="mb-3 p-2 bg-light border rounded">
        <p class="mb-0 small">
          工具箱會議及巡工事前安全衛生講題進行各知識討論(如最近發生的事故、作業場所的特殊危害、設備的安全操作、新的工作程序及人員相關的作業安全)，並請簽名。
        </p>
      </div>

      <form #meetingForm="ngForm" class="mb-3">
        <!-- 會議資訊表格 -->
        <table class="table table-bordered border-dark mb-0">
          <tbody>
            <!-- 第一行：會議日期、會議地點 -->
            <tr class="bg-light">
              <td
                style="width: 30%"
                colspan="2"
                class="text-center fw-normal py-2 px-2"
              >
                <div class="d-flex">
                  <span class="fw-bold me-2"
                    >會議日期<span class="text-danger">*</span>：</span
                  >
                  <input
                    type="date"
                    class="table-input flex-grow-1"
                    name="meetingDate"
                    [(ngModel)]="meetingData.applyDate"
                    aria-label="會議日期"
                    required
                  />
                </div>
              </td>
              <td
                style="width: 35%"
                colspan="2"
                class="text-center fw-normal py-2 px-2"
              >
                <div class="d-flex">
                  <span class="fw-bold me-2">會議時間：</span>
                  <input
                    type="time"
                    class="table-input flex-grow-1"
                    name="meetingTime"
                    [(ngModel)]="meetingData.meetingTime"
                    aria-label="會議時間"
                    required
                  />
                </div>
              </td>

              <td
                style="width: 35%"
                colspan="2"
                class="text-center fw-normal py-2 px-2"
              >
                <div class="d-flex">
                  <span class="fw-bold me-2">會議地點：</span>
                  <input
                    type="text"
                    class="table-input flex-grow-1"
                    name="meetingLocation"
                    [(ngModel)]="meetingData.meetingLocation"
                    placeholder="請輸入會議地點"
                    aria-label="會議地點"
                    required
                  />
                </div>
              </td>
            </tr>

            <!-- 表頭行：主持人、共同作業廠商、主承攬商、再承攬商 -->
            <tr class="bg-light">
              <td style="width: 15%" class="text-center fw-bold py-2 px-2">
                主持人
              </td>
              <td style="width: 15%" class="text-center fw-bold py-2 px-2">
                共同作業廠商
              </td>
              <td style="width: 17.5%" class="text-center fw-bold py-2 px-2">
                主承攬商
              </td>
              <td style="width: 17.5%" class="text-center fw-bold py-2 px-2">
                再承攬商(1)
              </td>
              <td style="width: 17.5%" class="text-center fw-bold py-2 px-2">
                再承攬商(2)
              </td>
              <td style="width: 17.5%" class="text-center fw-bold py-2 px-2">
                再承攬商(3)
              </td>
            </tr>

            <!-- 廠商名稱行 -->
            <tr>
              <td class="py-2 px-2" rowspan="2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="hostCompany"
                  [(ngModel)]="meetingData.hostPerson"
                  placeholder="主持人"
                  aria-label="主持人"
                />
              </td>
              <td class="text-center fw-normal bg-light py-2 px-2">廠商名稱</td>
              <td class="py-2 px-2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="contractorCompany0"
                  [(ngModel)]="meetingData.contractors[0].company"
                  placeholder="主承攬商"
                  aria-label="主承攬商名稱"
                />
              </td>
              <td class="py-2 px-2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="contractorCompany1"
                  [(ngModel)]="meetingData.contractors[1].company"
                  placeholder="再承攬商1"
                  aria-label="再承攬商1名稱"
                />
              </td>
              <td class="py-2 px-2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="contractorCompany2"
                  [(ngModel)]="meetingData.contractors[2].company"
                  placeholder="再承攬商2"
                  aria-label="再承攬商2名稱"
                />
              </td>
              <td class="py-2 px-2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="contractorCompany3"
                  [(ngModel)]="meetingData.contractors[3].company"
                  placeholder="再承攬商3"
                  aria-label="再承攬商3名稱"
                />
              </td>
            </tr>

            <!-- 與會人員行 -->
            <tr>
              <td class="text-center fw-normal bg-light py-2 px-2">與會人員</td>
              <td class="py-2 px-2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="contractorName0"
                  [(ngModel)]="meetingData.contractors[0].name"
                  placeholder="主承攬商人員"
                  aria-label="主承攬商人員"
                />
              </td>
              <td class="py-2 px-2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="contractorName1"
                  [(ngModel)]="meetingData.contractors[1].name"
                  placeholder="再承攬商1人員"
                  aria-label="再承攬商1人員"
                />
              </td>
              <td class="py-2 px-2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="contractorName2"
                  [(ngModel)]="meetingData.contractors[2].name"
                  placeholder="再承攬商2人員"
                  aria-label="再承攬商2人員"
                />
              </td>
              <td class="py-2 px-2">
                <input
                  type="text"
                  class="form-control table-input text-center"
                  name="contractorName3"
                  [(ngModel)]="meetingData.contractors[3].name"
                  placeholder="再承攬商3人員"
                  aria-label="再承攬商3人員"
                />
              </td>
            </tr>

            <!-- 本日工作項目 -->
            <tr>
              <td
                class="text-center fw-bold bg-light py-2 px-2 align-middle"
                style="writing-mode: vertical-lr; text-orientation: upright"
              >
                本日工作項目
              </td>
              <td colspan="5" class="py-2 px-2">
                <textarea
                  class="form-control table-input flex-grow-1"
                  name="workItem0"
                  [(ngModel)]="meetingData.workItems[0].description"
                  rows="4"
                  placeholder="請輸入本日工作項目"
                  aria-label="本日工作項目"
                  required
                ></textarea>
              </td>
            </tr>

            <!-- 本日工作地點 -->
            <tr>
              <td
                class="text-center fw-bold bg-light py-2 px-2 align-middle"
                style="writing-mode: vertical-lr; text-orientation: upright"
              >
                本日工作地點
              </td>
              <td colspan="5" class="py-2 px-2">
                <div class="d-flex align-items-center">
                  <textarea
                    class="form-control table-input flex-grow-1"
                    name="workItem1"
                    [(ngModel)]="meetingData.workItems[1].description"
                    rows="4"
                    placeholder="請輸入本日工作地點"
                    aria-label="本日工作地點"
                    required
                  ></textarea>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- 危害識別說明 -->
        <div class="mt-4 mb-2">
          <p class="mb-1 fw-bold">
            *本日作業區域/如作業現場可能潛在危害(請逐一確認，有請「V」，無請「X」；無該危害)
          </p>
        </div>

        <!-- 危害識別表格 -->
        <div class="border border-dark">
          <!-- 物理性危害 -->
          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-bold">物理性危害</span>
            </div>
            <div style="width: 85%" class="py-2 px-2">
              <div class="d-flex flex-wrap gap-3">
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('fallDrop')"
                    [title]="getTriStateTitle('fallDrop')"
                    (click)="toggleTriState('fallDrop')"
                  >
                    <i class="fas" [class]="getTriStateIcon('fallDrop')"></i>
                  </span>
                  <label class="form-check-label">跌墜落</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('physicalInjury')"
                    [title]="getTriStateTitle('physicalInjury')"
                    (click)="toggleTriState('physicalInjury')"
                  >
                    <i class="fas" [class]="getTriStateIcon('physicalInjury')"></i>
                  </span>
                  <label class="form-check-label">擦、刺、扭、壓、夾、碰撞、割傷</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('fallObject')"
                    [title]="getTriStateTitle('fallObject')"
                    (click)="toggleTriState('fallObject')"
                  >
                    <i class="fas" [class]="getTriStateIcon('fallObject')"></i>
                  </span>
                  <label class="form-check-label">物體飛落</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('foreignObjectInEye')"
                    [title]="getTriStateTitle('foreignObjectInEye')"
                    (click)="toggleTriState('foreignObjectInEye')"
                  >
                    <i class="fas" [class]="getTriStateIcon('foreignObjectInEye')"></i>
                  </span>
                  <label class="form-check-label">異物入眼</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('highTempContact')"
                    [title]="getTriStateTitle('highTempContact')"
                    (click)="toggleTriState('highTempContact')"
                  >
                    <i class="fas" [class]="getTriStateIcon('highTempContact')"></i>
                  </span>
                  <label class="form-check-label">與高溫接觸</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('lowTempContact')"
                    [title]="getTriStateTitle('lowTempContact')"
                    (click)="toggleTriState('lowTempContact')"
                  >
                    <i class="fas" [class]="getTriStateIcon('lowTempContact')"></i>
                  </span>
                  <label class="form-check-label">與低溫接觸</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('noise')"
                    [title]="getTriStateTitle('noise')"
                    (click)="toggleTriState('noise')"
                  >
                    <i class="fas" [class]="getTriStateIcon('noise')"></i>
                  </span>
                  <label class="form-check-label">噪音</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('electric')"
                    [title]="getTriStateTitle('electric')"
                    (click)="toggleTriState('electric')"
                  >
                    <i class="fas" [class]="getTriStateIcon('electric')"></i>
                  </span>
                  <label class="form-check-label">感電</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('collapse')"
                    [title]="getTriStateTitle('collapse')"
                    (click)="toggleTriState('collapse')"
                  >
                    <i class="fas" [class]="getTriStateIcon('collapse')"></i>
                  </span>
                  <label class="form-check-label">塌陷</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('radiation')"
                    [title]="getTriStateTitle('radiation')"
                    (click)="toggleTriState('radiation')"
                  >
                    <i class="fas" [class]="getTriStateIcon('radiation')"></i>
                  </span>
                  <label class="form-check-label">游離輻射</label>
                </div>
              </div>
            </div>
          </div>

          <!-- 化學性危害 -->
          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-bold">化學性危害</span>
            </div>
            <div style="width: 85%" class="py-2 px-2">
              <div class="d-flex flex-wrap gap-3">
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('burn')"
                    [title]="getTriStateTitle('burn')"
                    (click)="toggleTriState('burn')"
                  >
                    <i class="fas" [class]="getTriStateIcon('burn')"></i>
                  </span>
                  <label class="form-check-label">化學性燒灼傷</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('inhalation')"
                    [title]="getTriStateTitle('inhalation')"
                    (click)="toggleTriState('inhalation')"
                  >
                    <i class="fas" [class]="getTriStateIcon('inhalation')"></i>
                  </span>
                  <label class="form-check-label">化學物吸入</label>
                </div>
              </div>
            </div>
          </div>

          <!-- 火災危害 -->
          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-bold">火災危害</span>
            </div>
            <div style="width: 85%" class="py-2 px-2">
              <div class="d-flex flex-wrap gap-3">
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('fire')"
                    [title]="getTriStateTitle('fire')"
                    (click)="toggleTriState('fire')"
                  >
                    <i class="fas" [class]="getTriStateIcon('fire')"></i>
                  </span>
                  <label class="form-check-label">火災</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('explosion')"
                    [title]="getTriStateTitle('explosion')"
                    (click)="toggleTriState('explosion')"
                  >
                    <i class="fas" [class]="getTriStateIcon('explosion')"></i>
                  </span>
                  <label class="form-check-label">爆炸</label>
                </div>
              </div>
            </div>
          </div>

          <!-- 其他危害 -->
          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-bold">其他危害</span>
            </div>
            <div style="width: 85%" class="py-2 px-2">
              <div class="d-flex flex-wrap gap-3 align-items-center">
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('none')"
                    [title]="getTriStateTitle('none')"
                    (click)="toggleTriState('none')"
                  >
                    <i class="fas" [class]="getTriStateIcon('none')"></i>
                  </span>
                  <label class="form-check-label">無</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('oxygenDeficiency')"
                    [title]="getTriStateTitle('oxygenDeficiency')"
                    (click)="toggleTriState('oxygenDeficiency')"
                  >
                    <i class="fas" [class]="getTriStateIcon('oxygenDeficiency')"></i>
                  </span>
                  <label class="form-check-label">缺氧</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('biological')"
                    [title]="getTriStateTitle('biological')"
                    (click)="toggleTriState('biological')"
                  >
                    <i class="fas" [class]="getTriStateIcon('biological')"></i>
                  </span>
                  <label class="form-check-label">生物性危害</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('outdoorHighTemp')"
                    [title]="getTriStateTitle('outdoorHighTemp')"
                    (click)="toggleTriState('outdoorHighTemp')"
                  >
                    <i class="fas" [class]="getTriStateIcon('outdoorHighTemp')"></i>
                  </span>
                  <label class="form-check-label">戶外高溫</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('other')"
                    [title]="getTriStateTitle('other')"
                    (click)="toggleTriState('other')"
                  >
                    <i class="fas" [class]="getTriStateIcon('other')"></i>
                  </span>
                  <label class="form-check-label me-2">其他：</label>
                  <input
                    type="text"
                    class="form-control border-bottom-only"
                    style="width: 200px"
                    name="otherContent"
                    [(ngModel)]="meetingData.hazards.other.otherContent"
                    placeholder="其他危害"
                    aria-label="其他危害"
                    [disabled]="getFieldValue('other') !== true"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- 化學品區域 -->
          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-bold"
                >作業區域或包含以下化學品及其附屬設備管線</span
              >
            </div>
            <div style="width: 85%" class="py-2 px-2">
              <div class="d-flex align-items-center gap-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    id="noChemicals"
                    name="chemicalArea"
                    [value]="true"
                    [(ngModel)]="meetingData.hazards.chemicalArea.hasChemicals"
                  />
                  <label class="form-check-label" for="noChemicals">無</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <input
                    class="form-check-input me-2"
                    type="radio"
                    id="hasChemicals"
                    name="chemicalArea"
                    [value]="false"
                    [(ngModel)]="meetingData.hazards.chemicalArea.hasChemicals"
                  />
                  <label class="form-check-label me-2" for="hasChemicals"
                    >化學品名稱：</label
                  >
                  <input
                    type="text"
                    class="form-control border-bottom-only"
                    style="width: 300px"
                    name="chemicalNames"
                    [(ngModel)]="meetingData.hazards.chemicalArea.chemicalNames"
                    placeholder="化學品名稱"
                    aria-label="化學品名稱"
                    [disabled]="meetingData.hazards.chemicalArea.hasChemicals"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- 氣體區域 -->
          <div class="d-flex">
            <div
              style="width: 15%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-bold"
                >作業區域或包含以下氣體及其附屬設備管線</span
              >
            </div>
            <div style="width: 85%" class="py-2 px-2">
              <div class="d-flex align-items-center gap-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    id="noGas"
                    name="gasArea"
                    [value]="true"
                    [(ngModel)]="meetingData.hazards.gasArea.hasGas"
                  />
                  <label class="form-check-label" for="noGas">無</label>
                </div>
                <div class="form-check d-flex align-items-center">
                  <input
                    class="form-check-input me-2"
                    type="radio"
                    id="hasGas"
                    name="gasArea"
                    [value]="false"
                    [(ngModel)]="meetingData.hazards.gasArea.hasGas"
                  />
                  <label class="form-check-label me-2" for="hasGas"
                    >氣體名稱：</label
                  >
                  <input
                    type="text"
                    class="form-control border-bottom-only"
                    style="width: 300px"
                    name="gasNames"
                    [(ngModel)]="meetingData.hazards.gasArea.gasNames"
                    placeholder="氣體名稱"
                    aria-label="氣體名稱"
                    [disabled]="meetingData.hazards.gasArea.hasGas"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 安全衛生措施說明 -->
        <div class="mt-4 mb-2">
          <p class="mb-1 fw-bold">
            *本日應採取之安全衛生措施（請逐一確認，有請「V」，無請「X」；個人防護具需功能正常方可使用）
          </p>
        </div>

        <!-- 安全衛生措施表格 -->
        <table class="table table-bordered border-dark mb-0">
          <tbody>
            <!-- 表頭行 -->
            <tr class="bg-light">
              <td
                rowspan="13"
                class="text-center align-middle fw-bold"
                style="
                  width: 5%;
                  writing-mode: vertical-lr;
                  text-orientation: upright;
                "
              >
                依作業性質穿戴之安全防護具及措施
              </td>
            </tr>
            <!-- 01. 頭部防護 -->
            <tr>
              <td class="bg-light fw-normal" style="width: 20%">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('headProtection')"
                    [title]="getTriStateTitle('headProtection')"
                    (click)="toggleTriState('headProtection')"
                  >
                    <i class="fas" [class]="getTriStateIcon('headProtection')"></i>
                  </span>
                  <label class="form-check-label">01.頭部防護：</label>
                </div>
              </td>
              <td style="width: 75%">
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('workSiteHead')"
                      [title]="getTriStateTitle('workSiteHead')"
                      (click)="toggleTriState('workSiteHead')"
                    >
                      <i class="fas" [class]="getTriStateIcon('workSiteHead')"></i>
                    </span>
                    <label class="form-check-label">工地用</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('electricianHead')"
                      [title]="getTriStateTitle('electricianHead')"
                      (click)="toggleTriState('electricianHead')"
                    >
                      <i class="fas" [class]="getTriStateIcon('electricianHead')"></i>
                    </span>
                    <label class="form-check-label">電工用</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('helmetHead')"
                      [title]="getTriStateTitle('helmetHead')"
                      (click)="toggleTriState('helmetHead')"
                    >
                      <i class="fas" [class]="getTriStateIcon('helmetHead')"></i>
                    </span>
                    <label class="form-check-label">膠盔</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 02. 眼部防護 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('eyeProtection')"
                    [title]="getTriStateTitle('eyeProtection')"
                    (click)="toggleTriState('eyeProtection')"
                  >
                    <i class="fas" [class]="getTriStateIcon('eyeProtection')"></i>
                  </span>
                  <label class="form-check-label">02.眼部防護：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('mechanicalEyes')"
                      [title]="getTriStateTitle('mechanicalEyes')"
                      (click)="toggleTriState('mechanicalEyes')"
                    >
                      <i class="fas" [class]="getTriStateIcon('mechanicalEyes')"></i>
                    </span>
                    <label class="form-check-label">防禦機械能傷害的安全眼鏡</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('radiationEyes')"
                      [title]="getTriStateTitle('radiationEyes')"
                      (click)="toggleTriState('radiationEyes')"
                    >
                      <i class="fas" [class]="getTriStateIcon('radiationEyes')"></i>
                    </span>
                    <label class="form-check-label">防禦輻射能傷害的安全眼鏡</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 03. 耳部防護 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('earProtection')"
                    [title]="getTriStateTitle('earProtection')"
                    (click)="toggleTriState('earProtection')"
                  >
                    <i class="fas" [class]="getTriStateIcon('earProtection')"></i>
                  </span>
                  <label class="form-check-label">03.耳部防護：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('earPlugs')"
                      [title]="getTriStateTitle('earPlugs')"
                      (click)="toggleTriState('earPlugs')"
                    >
                      <i class="fas" [class]="getTriStateIcon('earPlugs')"></i>
                    </span>
                    <label class="form-check-label">耳塞</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('earMuffs')"
                      [title]="getTriStateTitle('earMuffs')"
                      (click)="toggleTriState('earMuffs')"
                    >
                      <i class="fas" [class]="getTriStateIcon('earMuffs')"></i>
                    </span>
                    <label class="form-check-label">耳罩</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 04. 呼吸防護 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('breathProtection')"
                    [title]="getTriStateTitle('breathProtection')"
                    (click)="toggleTriState('breathProtection')"
                  >
                    <i class="fas" [class]="getTriStateIcon('breathProtection')"></i>
                  </span>
                  <label class="form-check-label">04.呼吸防護：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('dustMask')"
                      [title]="getTriStateTitle('dustMask')"
                      (click)="toggleTriState('dustMask')"
                    >
                      <i class="fas" [class]="getTriStateIcon('dustMask')"></i>
                    </span>
                    <label class="form-check-label">防塵</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('toxicMask')"
                      [title]="getTriStateTitle('toxicMask')"
                      (click)="toggleTriState('toxicMask')"
                    >
                      <i class="fas" [class]="getTriStateIcon('toxicMask')"></i>
                    </span>
                    <label class="form-check-label">濾毒</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('scba')"
                      [title]="getTriStateTitle('scba')"
                      (click)="toggleTriState('scba')"
                    >
                      <i class="fas" [class]="getTriStateIcon('scba')"></i>
                    </span>
                    <label class="form-check-label">SCBA</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('papr')"
                      [title]="getTriStateTitle('papr')"
                      (click)="toggleTriState('papr')"
                    >
                      <i class="fas" [class]="getTriStateIcon('papr')"></i>
                    </span>
                    <label class="form-check-label">PAPR</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('airlineMask')"
                      [title]="getTriStateTitle('airlineMask')"
                      (click)="toggleTriState('airlineMask')"
                    >
                      <i class="fas" [class]="getTriStateIcon('airlineMask')"></i>
                    </span>
                    <label class="form-check-label">輸氣管面罩</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 05. 手部防護 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('handProtection')"
                    [title]="getTriStateTitle('handProtection')"
                    (click)="toggleTriState('handProtection')"
                  >
                    <i class="fas" [class]="getTriStateIcon('handProtection')"></i>
                  </span>
                  <label class="form-check-label">05.手部防護：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('cutResistantGloves')"
                      [title]="getTriStateTitle('cutResistantGloves')"
                      (click)="toggleTriState('cutResistantGloves')"
                    >
                      <i class="fas" [class]="getTriStateIcon('cutResistantGloves')"></i>
                    </span>
                    <label class="form-check-label">耐切割</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('wearResistantGloves')"
                      [title]="getTriStateTitle('wearResistantGloves')"
                      (click)="toggleTriState('wearResistantGloves')"
                    >
                      <i class="fas" [class]="getTriStateIcon('wearResistantGloves')"></i>
                    </span>
                    <label class="form-check-label">耐磨</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('heatResistantGloves')"
                      [title]="getTriStateTitle('heatResistantGloves')"
                      (click)="toggleTriState('heatResistantGloves')"
                    >
                      <i class="fas" [class]="getTriStateIcon('heatResistantGloves')"></i>
                    </span>
                    <label class="form-check-label">耐熱</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('electricianGloves')"
                      [title]="getTriStateTitle('electricianGloves')"
                      (click)="toggleTriState('electricianGloves')"
                    >
                      <i class="fas" [class]="getTriStateIcon('electricianGloves')"></i>
                    </span>
                    <label class="form-check-label">電工用</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('chemicalGloves')"
                      [title]="getTriStateTitle('chemicalGloves')"
                      (click)="toggleTriState('chemicalGloves')"
                    >
                      <i class="fas" [class]="getTriStateIcon('chemicalGloves')"></i>
                    </span>
                    <label class="form-check-label">防化學</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 06. 足部防護 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('footProtection')"
                    [title]="getTriStateTitle('footProtection')"
                    (click)="toggleTriState('footProtection')"
                  >
                    <i class="fas" [class]="getTriStateIcon('footProtection')"></i>
                  </span>
                  <label class="form-check-label">06.足部防護：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('safetyShoes')"
                      [title]="getTriStateTitle('safetyShoes')"
                      (click)="toggleTriState('safetyShoes')"
                    >
                      <i class="fas" [class]="getTriStateIcon('safetyShoes')"></i>
                    </span>
                    <label class="form-check-label">一般安全鞋</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('chemicalShoes')"
                      [title]="getTriStateTitle('chemicalShoes')"
                      (click)="toggleTriState('chemicalShoes')"
                    >
                      <i class="fas" [class]="getTriStateIcon('chemicalShoes')"></i>
                    </span>
                    <label class="form-check-label">防化學安全鞋</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 07. 身體防護 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('bodyProtection')"
                    [title]="getTriStateTitle('bodyProtection')"
                    (click)="toggleTriState('bodyProtection')"
                  >
                    <i class="fas" [class]="getTriStateIcon('bodyProtection')"></i>
                  </span>
                  <label class="form-check-label">07.身體防護：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('backpackBelt')"
                      [title]="getTriStateTitle('backpackBelt')"
                      (click)="toggleTriState('backpackBelt')"
                    >
                      <i class="fas" [class]="getTriStateIcon('backpackBelt')"></i>
                    </span>
                    <label class="form-check-label">背負式安全帶</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('weldingMask')"
                      [title]="getTriStateTitle('weldingMask')"
                      (click)="toggleTriState('weldingMask')"
                    >
                      <i class="fas" [class]="getTriStateIcon('weldingMask')"></i>
                    </span>
                    <label class="form-check-label">電焊用防護面具</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('chemicalProtection')"
                      [title]="getTriStateTitle('chemicalProtection')"
                      (click)="toggleTriState('chemicalProtection')"
                    >
                      <i class="fas" [class]="getTriStateIcon('chemicalProtection')"></i>
                    </span>
                    <label class="form-check-label">化學防護衣</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('reflectiveVest')"
                      [title]="getTriStateTitle('reflectiveVest')"
                      (click)="toggleTriState('reflectiveVest')"
                    >
                      <i class="fas" [class]="getTriStateIcon('reflectiveVest')"></i>
                    </span>
                    <label class="form-check-label">反光背心</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 08. 墜落預防 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('fallPrevention')"
                    [title]="getTriStateTitle('fallPrevention')"
                    (click)="toggleTriState('fallPrevention')"
                  >
                    <i class="fas" [class]="getTriStateIcon('fallPrevention')"></i>
                  </span>
                  <label class="form-check-label">08.墜落預防：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('ladder')"
                      [title]="getTriStateTitle('ladder')"
                      (click)="toggleTriState('ladder')"
                    >
                      <i class="fas" [class]="getTriStateIcon('ladder')"></i>
                    </span>
                    <label class="form-check-label">合梯</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('mobileLadder')"
                      [title]="getTriStateTitle('mobileLadder')"
                      (click)="toggleTriState('mobileLadder')"
                    >
                      <i class="fas" [class]="getTriStateIcon('mobileLadder')"></i>
                    </span>
                    <label class="form-check-label">移動梯</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('scaffold')"
                      [title]="getTriStateTitle('scaffold')"
                      (click)="toggleTriState('scaffold')"
                    >
                      <i class="fas" [class]="getTriStateIcon('scaffold')"></i>
                    </span>
                    <label class="form-check-label">施工架</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('highWorkVehicle')"
                      [title]="getTriStateTitle('highWorkVehicle')"
                      (click)="toggleTriState('highWorkVehicle')"
                    >
                      <i class="fas" [class]="getTriStateIcon('highWorkVehicle')"></i>
                    </span>
                    <label class="form-check-label">高空工作車</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('safetyLine')"
                      [title]="getTriStateTitle('safetyLine')"
                      (click)="toggleTriState('safetyLine')"
                    >
                      <i class="fas" [class]="getTriStateIcon('safetyLine')"></i>
                    </span>
                    <label class="form-check-label">安全母索</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('protectionCage')"
                      [title]="getTriStateTitle('protectionCage')"
                      (click)="toggleTriState('protectionCage')"
                    >
                      <i class="fas" [class]="getTriStateIcon('protectionCage')"></i>
                    </span>
                    <label class="form-check-label">護籠</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('guardrail')"
                      [title]="getTriStateTitle('guardrail')"
                      (click)="toggleTriState('guardrail')"
                    >
                      <i class="fas" [class]="getTriStateIcon('guardrail')"></i>
                    </span>
                    <label class="form-check-label">護欄</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('protectionCover')"
                      [title]="getTriStateTitle('protectionCover')"
                      (click)="toggleTriState('protectionCover')"
                    >
                      <i class="fas" [class]="getTriStateIcon('protectionCover')"></i>
                    </span>
                    <label class="form-check-label">護蓋</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('safetyNet')"
                      [title]="getTriStateTitle('safetyNet')"
                      (click)="toggleTriState('safetyNet')"
                    >
                      <i class="fas" [class]="getTriStateIcon('safetyNet')"></i>
                    </span>
                    <label class="form-check-label">安全網</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('warningBarrier')"
                      [title]="getTriStateTitle('warningBarrier')"
                      (click)="toggleTriState('warningBarrier')"
                    >
                      <i class="fas" [class]="getTriStateIcon('warningBarrier')"></i>
                    </span>
                    <label class="form-check-label">警示圍籬</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('fallPreventer')"
                      [title]="getTriStateTitle('fallPreventer')"
                      (click)="toggleTriState('fallPreventer')"
                    >
                      <i class="fas" [class]="getTriStateIcon('fallPreventer')"></i>
                    </span>
                    <label class="form-check-label">墜落防止器</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 09. 感電預防 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('electricPrevention')"
                    [title]="getTriStateTitle('electricPrevention')"
                    (click)="toggleTriState('electricPrevention')"
                  >
                    <i class="fas" [class]="getTriStateIcon('electricPrevention')"></i>
                  </span>
                  <label class="form-check-label">09.感電預防：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('leakageBreaker')"
                      [title]="getTriStateTitle('leakageBreaker')"
                      (click)="toggleTriState('leakageBreaker')"
                    >
                      <i class="fas" [class]="getTriStateIcon('leakageBreaker')"></i>
                    </span>
                    <label class="form-check-label">漏電斷路器</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('autoElectricPreventer')"
                      [title]="getTriStateTitle('autoElectricPreventer')"
                      (click)="toggleTriState('autoElectricPreventer')"
                    >
                      <i class="fas" [class]="getTriStateIcon('autoElectricPreventer')"></i>
                    </span>
                    <label class="form-check-label">交流電焊機自動電擊防止裝置</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('voltageDetector')"
                      [title]="getTriStateTitle('voltageDetector')"
                      (click)="toggleTriState('voltageDetector')"
                    >
                      <i class="fas" [class]="getTriStateIcon('voltageDetector')"></i>
                    </span>
                    <label class="form-check-label">檢電器</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 10. 火災預防 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('firePrevention')"
                    [title]="getTriStateTitle('firePrevention')"
                    (click)="toggleTriState('firePrevention')"
                  >
                    <i class="fas" [class]="getTriStateIcon('firePrevention')"></i>
                  </span>
                  <label class="form-check-label">10.火災預防：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('fireExtinguisher')"
                      [title]="getTriStateTitle('fireExtinguisher')"
                      (click)="toggleTriState('fireExtinguisher')"
                    >
                      <i class="fas" [class]="getTriStateIcon('fireExtinguisher')"></i>
                    </span>
                    <label class="form-check-label">滅火器</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('fireBlanket')"
                      [title]="getTriStateTitle('fireBlanket')"
                      (click)="toggleTriState('fireBlanket')"
                    >
                      <i class="fas" [class]="getTriStateIcon('fireBlanket')"></i>
                    </span>
                    <label class="form-check-label">防火毯</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('oxyacetyleneFireback')"
                      [title]="getTriStateTitle('oxyacetyleneFireback')"
                      (click)="toggleTriState('oxyacetyleneFireback')"
                    >
                      <i class="fas" [class]="getTriStateIcon('oxyacetyleneFireback')"></i>
                    </span>
                    <label class="form-check-label">氧乙炔防回火裝置</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 11. 缺氧預防 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('oxygenPrevention')"
                    [title]="getTriStateTitle('oxygenPrevention')"
                    (click)="toggleTriState('oxygenPrevention')"
                  >
                    <i class="fas" [class]="getTriStateIcon('oxygenPrevention')"></i>
                  </span>
                  <label class="form-check-label">11.缺氧預防：</label>
                </div>
              </td>
              <td>
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('ventilation')"
                      [title]="getTriStateTitle('ventilation')"
                      (click)="toggleTriState('ventilation')"
                    >
                      <i class="fas" [class]="getTriStateIcon('ventilation')"></i>
                    </span>
                    <label class="form-check-label">通風設備</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('lifeDetector')"
                      [title]="getTriStateTitle('lifeDetector')"
                      (click)="toggleTriState('lifeDetector')"
                    >
                      <i class="fas" [class]="getTriStateIcon('lifeDetector')"></i>
                    </span>
                    <label class="form-check-label">生命偵測裝置</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('gasDetector')"
                      [title]="getTriStateTitle('gasDetector')"
                      (click)="toggleTriState('gasDetector')"
                    >
                      <i class="fas" [class]="getTriStateIcon('gasDetector')"></i>
                    </span>
                    <label class="form-check-label">氣體偵測器</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('liftingEquipment')"
                      [title]="getTriStateTitle('liftingEquipment')"
                      (click)="toggleTriState('liftingEquipment')"
                    >
                      <i class="fas" [class]="getTriStateIcon('liftingEquipment')"></i>
                    </span>
                    <label class="form-check-label">吊升設備</label>
                  </div>
                  <div class="form-check d-flex align-items-center">
                    <span 
                      [class]="getTriStateContainerClass('rescueEquipment')"
                      [title]="getTriStateTitle('rescueEquipment')"
                      (click)="toggleTriState('rescueEquipment')"
                    >
                      <i class="fas" [class]="getTriStateIcon('rescueEquipment')"></i>
                    </span>
                    <label class="form-check-label">搶救設備</label>
                  </div>
                </div>
              </td>
            </tr>

            <!-- 12. 其他預防 -->
            <tr>
              <td class="bg-light fw-normal">
                <div class="d-flex align-items-center">
                  <span 
                    [class]="getTriStateContainerClass('otherPrevention')"
                    [title]="getTriStateTitle('otherPrevention')"
                    (click)="toggleTriState('otherPrevention')"
                  >
                    <i class="fas" [class]="getTriStateIcon('otherPrevention')"></i>
                  </span>
                  <label class="form-check-label">12.其他預防：</label>
                </div>
              </td>
              <td>
                <div class="d-flex align-items-center gap-3">
                  <input
                    type="text"
                    class="form-control border-bottom-only"
                    style="width: 400px"
                    name="otherPreventionContent"
                    [(ngModel)]="meetingData.safetyPrecautions.personalProtection.otherContent"
                    placeholder="其他防護措施"
                    aria-label="其他防護措施"
                  />
                </div>
              </td>
            </tr>

            <!-- 其他溝通/協議/宣導事項 -->
            <tr>
              <td colspan="3" class=" fw-bold py-3">
                <div class="mb-2">
                  <span class="fw-bold">其他溝通/協議/宣導事項：</span>
                </div>
                <textarea
                  class="form-control table-input"
                  name="communicationItems"
                  [(ngModel)]="meetingData.communicationItems"
                  rows="4"
                  placeholder="請輸入其他溝通、協議或宣導事項"
                  aria-label="其他溝通/協議/宣導事項"
                ></textarea>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- 健康危害告知表說明 -->
        <div class="mt-4 mb-2">
          <p class="mb-1 fw-bold">
            *健康危害告知(依勞工健康保護規則規定，有下列疾病人員，不得從事相對應的作業)
          </p>
        </div>

        <!-- 健康危害告知表 -->
        <div class="border border-dark">
          <!-- 表頭 -->
          <div class="d-flex border-bottom border-dark bg-light">
            <div
              style="width: 15%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold">作業名稱</span>
            </div>
            <div
              style="width: 85%"
              class="d-flex align-items-center justify-content-center py-2 px-2"
            >
              <span class="fw-bold">考量不適合從事作業之疾病</span>
            </div>
          </div>

          <!-- 各項危害 -->
          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-normal">噪音作業</span>
            </div>
            <div style="width: 85%" class="d-flex align-items-center py-2 px-2">
              <span>心血管疾病、聽力異常。</span>
            </div>
          </div>

          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-normal">振動作業</span>
            </div>
            <div style="width: 85%" class="d-flex align-items-center py-2 px-2">
              <span>周邊神經系統疾病、周邊循環系統疾病、骨骼肌肉系統疾病。</span>
            </div>
          </div>

          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-normal">游離輻射作業</span>
            </div>
            <div style="width: 85%" class="d-flex align-items-center py-2 px-2">
              <span>血液疾病、內分泌疾病、精神與神經異常、眼睛疾病、惡性腫瘤。</span>
            </div>
          </div>

          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-normal">非游離輻射作業</span>
            </div>
            <div style="width: 85%" class="d-flex align-items-center py-2 px-2">
              <span>眼睛疾病、內分泌系統疾病。</span>
            </div>
          </div>

          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-normal">高架作業</span>
            </div>
            <div style="width: 85%" class="d-flex align-items-center py-2 px-2">
              <span>癲癇、精神或神經系統疾病、高血壓、心血管疾病、貧血、平衡機能失常、呼吸系統疾病、色盲、視力不良、聽力障礙、肢體殘障。</span>
            </div>
          </div>

          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-normal">粉塵作業</span>
            </div>
            <div style="width: 85%" class="d-flex align-items-center py-2 px-2">
              <span>心血管疾病、慢性阻塞性肺疾病、慢性氣管炎、氣喘等。</span>
            </div>
          </div>

          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 15%"
              class="d-flex align-items-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-normal">正己烷作業</span>
            </div>
            <div style="width: 85%" class="d-flex align-items-center py-2 px-2">
              <span>周邊神經系統疾病、接觸性皮膚疾病等。</span>
            </div>
          </div>

          <div class="d-flex">
            <div
              style="width: 15%"
              class="d-flex align-items-center border-end border-dark py-2 px-2 bg-light"
            >
              <span class="fw-normal">重體力勞動作業</span>
            </div>
            <div style="width: 85%" class="d-flex align-items-center py-2 px-2">
              <span>呼吸系統疾病、高血壓、心血管疾病、貧血、肝病、腎臟疾病、精神或神經系統疾病、骨骼肌肉系統疾病、內分泌系統疾病、視網膜玻璃體疾病、肢體殘障。</span>
            </div>
          </div>
        </div>

        <!-- 出席人員簽名說明 -->
        <div class="mt-4 mb-2">
          <p class="mb-1 fw-bold">
            *出席人員簽名(簽名時，本人已了解下列事項)：
          </p>
          <ol class="ps-3">
            <li>
              已了解今日作業環境及作業內容的危害並願意使用防護具及遵守各項防範措施。
            </li>
            <li>
              已了解健康危害告知內容，本人如有上述疾病時，不會從事該項作業。
            </li>
          </ol>
        </div>

        <!-- 出席人員簽名表 -->
        <div class="border border-dark">
          <!-- 表頭 -->
          <div class="d-flex border-bottom border-dark bg-light">
            <div
              style="width: 4%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold">No</span>
            </div>
            <div
              style="width: 24%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold">主承攬商</span>
            </div>
            <div
              style="width: 24%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold">再承攬商(1)</span>
            </div>
            <div
              style="width: 24%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold">再承攬商(2)</span>
            </div>
            <div
              style="width: 24%"
              class="d-flex align-items-center justify-content-center py-2 px-2"
            >
              <span class="fw-bold">再承攬商(3)</span>
            </div>
          </div>

          <!-- 簽名行 -->
          @for (i of [0,1,2,3,4,5,6,7,8,9]; track i) {
          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 4%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold">{{ formatNo(i) }}</span>
            </div>
            <!-- 主承攬商 -->
            <div
              style="width: 24%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-1 px-1"
            >
              <div
                class="border signature-area w-100 text-center"
                [class.cursor-pointer]="!isSignatureSlotSigned(meetingData.healthWarnings.attendeeMainContractorSignatures[i])"
                [class.signed-slot]="isSignatureSlotSigned(meetingData.healthWarnings.attendeeMainContractorSignatures[i])"
                (click)="!isSignatureSlotSigned(meetingData.healthWarnings.attendeeMainContractorSignatures[i]) && showWorkerVerificationModal(0)"
                [title]="isSignatureSlotSigned(meetingData.healthWarnings.attendeeMainContractorSignatures[i]) ? getSignatureTooltip(meetingData.healthWarnings.attendeeMainContractorSignatures[i]) : ''"
                style="height: 40px"
              >
                @if (getSignatureImage(meetingData.healthWarnings.attendeeMainContractorSignatures[i])) {
                <img
                  [src]="getSignatureImage(meetingData.healthWarnings.attendeeMainContractorSignatures[i])"
                  alt="主承攬商簽名"
                  class="signature-image"
                  style="max-height: 38px"
                />
                } @else {
                <div class="signature-placeholder small text-muted">
                  工人簽名
                </div>
                }
              </div>
            </div>
            <!-- 再承攬商(1) -->
            <div
              style="width: 24%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-1 px-1"
            >
              <div
                class="border signature-area w-100 text-center"
                [class.cursor-pointer]="!isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor1Signatures[i])"
                [class.signed-slot]="isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor1Signatures[i])"
                (click)="!isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor1Signatures[i]) && showWorkerVerificationModal(1)"
                [title]="isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor1Signatures[i]) ? getSignatureTooltip(meetingData.healthWarnings.attendeeSubcontractor1Signatures[i]) : ''"
                style="height: 40px"
              >
                @if (getSignatureImage(meetingData.healthWarnings.attendeeSubcontractor1Signatures[i])) {
                <img
                  [src]="getSignatureImage(meetingData.healthWarnings.attendeeSubcontractor1Signatures[i])"
                  alt="再承攬商簽名"
                  class="signature-image"
                  style="max-height: 38px"
                />
                } @else {
                <div class="signature-placeholder small text-muted">
                  工人簽名
                </div>
                }
              </div>
            </div>
            <!-- 再承攬商(2) -->
            <div
              style="width: 24%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-1 px-1"
            >
              <div
                class="border signature-area w-100 text-center"
                [class.cursor-pointer]="!isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor2Signatures[i])"
                [class.signed-slot]="isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor2Signatures[i])"
                (click)="!isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor2Signatures[i]) && showWorkerVerificationModal(2)"
                [title]="isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor2Signatures[i]) ? getSignatureTooltip(meetingData.healthWarnings.attendeeSubcontractor2Signatures[i]) : ''"
                style="height: 40px"
              >
                @if (getSignatureImage(meetingData.healthWarnings.attendeeSubcontractor2Signatures[i])) {
                <img
                  [src]="getSignatureImage(meetingData.healthWarnings.attendeeSubcontractor2Signatures[i])"
                  alt="再承攬商簽名"
                  class="signature-image"
                  style="max-height: 38px"
                />
                } @else {
                <div class="signature-placeholder small text-muted">
                  工人簽名
                </div>
                }
              </div>
            </div>
            <!-- 再承攬商(3) -->
            <div
              style="width: 24%"
              class="d-flex align-items-center justify-content-center py-1 px-1"
            >
              <div
                class="border signature-area w-100 text-center"
                [class.cursor-pointer]="!isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor3Signatures[i])"
                [class.signed-slot]="isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor3Signatures[i])"
                (click)="!isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor3Signatures[i]) && showWorkerVerificationModal(3)"
                [title]="isSignatureSlotSigned(meetingData.healthWarnings.attendeeSubcontractor3Signatures[i]) ? getSignatureTooltip(meetingData.healthWarnings.attendeeSubcontractor3Signatures[i]) : ''"
                style="height: 40px"
              >
                @if (getSignatureImage(meetingData.healthWarnings.attendeeSubcontractor3Signatures[i])) {
                <img
                  [src]="getSignatureImage(meetingData.healthWarnings.attendeeSubcontractor3Signatures[i])"
                  alt="再承攬商簽名"
                  class="signature-image"
                  style="max-height: 38px"
                />
                } @else {
                <div class="signature-placeholder small text-muted">
                  工人簽名
                </div>
                }
              </div>
            </div>
          </div>
          }
        </div>

        <!-- 作業現場巡檢紀錄說明 -->
        <div class="mt-4 mb-2">
          <p class="mb-1 fw-bold">
            *作業現場巡檢紀錄(確認檢查項目均符規定後方可作業)
          </p>
        </div>

        <!-- 作業現場巡檢紀錄表 -->
        <div class="border border-dark">
          <!-- 表頭 -->
          <div class="d-flex border-bottom border-dark bg-light">
            <div
              style="width: 5%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold">序號</span>
            </div>
            <div
              style="width: 65%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold">檢查項目</span>
            </div>
            <div
              style="width: 22.5%"
              class="d-flex flex-column align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-bold mb-1">主承攬商監工人員巡檢欄</span>
              <div class="d-flex w-100">
                <div
                  style="width: 33.33%"
                  class="text-center border-end border-dark py-1"
                >
                  <small class="fw-bold">施工前</small>
                </div>
                <div
                  style="width: 33.33%"
                  class="text-center border-end border-dark py-1"
                >
                  <small class="fw-bold">施工中</small>
                </div>
                <div style="width: 33.33%" class="text-center py-1">
                  <small class="fw-bold">收工前</small>
                </div>
              </div>
            </div>
            <div
              style="width: 7.5%"
              class="d-flex flex-column align-items-center justify-content-center py-2 px-2"
            >
              <span class="fw-bold mb-1">監工單位</span>
              <div class="text-center py-1">
                <small class="fw-bold">巡檢欄</small>
              </div>
            </div>
          </div>

          <!-- 檢查項目行 -->
          @for (item of meetingData.fieldCheckItems; track $index) {
          <div class="d-flex border-bottom border-dark">
            <div
              style="width: 5%"
              class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
            >
              <span class="fw-normal">{{ item.id }}</span>
            </div>
            <div
              style="width: 65%"
              class="d-flex align-items-center border-end border-dark py-2 px-2"
            >
              <span class="small">{{ item.content }}</span>
            </div>
            <!-- 主承攬商監工人員巡檢欄 (22.5%) -->
            <div style="width: 22.5%" class="d-flex border-end border-dark">
              <!-- 施工前 -->
              <div
                style="width: 33.33%"
                class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
              >
                @if (item.id !== 5) {
                <input
                  class="form-check-input"
                  type="checkbox"
                  [id]="'checkBeforeStart' + $index"
                  name="checkBeforeStart{{ $index }}"
                  [(ngModel)]="item.checkBeforeStart"
                  title="施工前檢查"
                  aria-label="施工前檢查"
                />
                }
              </div>
              
              <!-- 施工中 -->
              <div
                style="width: 33.33%"
                class="d-flex align-items-center justify-content-center border-end border-dark py-2 px-2"
              >
                @if (item.id !== 1 && item.id !== 5) {
                <input
                  class="form-check-input"
                  type="checkbox"
                  [id]="'checkDuring' + $index"
                  name="checkDuring{{ $index }}"
                  [(ngModel)]="item.checkDuring"
                  title="施工中檢查"
                  aria-label="施工中檢查"
                />
                }
              </div>
              
              <!-- 收工前 -->
              <div
                style="width: 33.33%"
                class="d-flex align-items-center justify-content-center py-2 px-2"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  [id]="'checkBeforeEnd' + $index"
                  name="checkBeforeEnd{{ $index }}"
                  [(ngModel)]="item.checkBeforeEnd"
                  title="收工前檢查"
                  aria-label="收工前檢查"
                />
              </div>
            </div>
            
            <!-- 監工單位巡檢欄 (7.5%) -->
            <div style="width: 7.5%" class="d-flex">
              <div
                style="width: 100%"
                class="d-flex align-items-center justify-content-center py-2 px-2"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  [id]="'checkAfter' + $index"
                  name="checkAfter{{ $index }}"
                  [(ngModel)]="item.checkAfter"
                  title="巡檢欄檢查"
                  aria-label="巡檢欄檢查"
                />
              </div>
            </div>
          </div>
          }

          <!-- 備註及簽名區 -->
          <div class="d-flex">
            <div style="width: 70%" class="border-end border-dark">
              <div class="d-flex border-bottom border-dark">
                <div class="py-2 px-2">
                  <div class="d-flex gap-3">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="noRemarks"
                        name="noRemarks"
                        title="無其他及緊急情形"
                        aria-label="無其他及緊急情形"
                        [(ngModel)]="meetingData.noRemarks"
                      />
                      <label class="form-check-label" for="noRemarks"
                        >NA (無其他及緊急情形)</label
                      >
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="hasRemarks"
                        name="hasRemarks"
                        title="異常及緊急情形說明"
                        aria-label="異常及緊急情形說明"
                        [(ngModel)]="meetingData.hasRemarks"
                      />
                      <label class="form-check-label" for="hasRemarks"
                        >異常及緊急情形說明</label
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div class="py-2 px-2">
                <div class="mb-1 fw-bold">巡檢紀錄</div>
                <textarea
                  class="form-control table-input"
                  name="remarks"
                  [(ngModel)]="meetingData.remarks"
                  rows="3"
                  placeholder="請輸入巡檢紀錄"
                  aria-label="巡檢紀錄"
                ></textarea>
              </div>
            </div>
            <div style="width: 30%" class="d-flex">
              <!-- 施工前簽名 -->
              <div
                style="width: 25%"
                class="d-flex flex-column align-items-center justify-content-center border-end border-dark py-2 px-1"
              >
                <div class="mb-2 fw-bold small">巡檢人員簽名</div>
                <div
                  class="border signature-area w-100 text-center"
                  (click)="openSignatureDialog(SignatureType.BeforeWork)"
                  style="height: 60px; cursor: pointer"
                >
                  @if (beforeWorkSignature) {
                  <img
                    [src]="beforeWorkSignature"
                    alt="施工前巡檢人員簽名"
                    class="signature-image"
                    style="max-height: 58px"
                  />
                  } @else {
                  <div
                    class="signature-placeholder small text-muted d-flex align-items-center justify-content-center h-100"
                  >
                    點擊簽名
                  </div>
                  }
                </div>
              </div>
              <!-- 施工中簽名 -->
              <div
                style="width: 25%"
                class="d-flex flex-column align-items-center justify-content-center border-end border-dark py-2 px-1"
              >
                <div class="mb-2 fw-bold small">巡檢人員簽名</div>
                <div
                  class="border signature-area w-100 text-center"
                  (click)="openSignatureDialog(SignatureType.DuringWork)"
                  style="height: 60px; cursor: pointer"
                >
                  @if (duringWorkSignature) {
                  <img
                    [src]="duringWorkSignature"
                    alt="施工中巡檢人員簽名"
                    class="signature-image"
                    style="max-height: 58px"
                  />
                  } @else {
                  <div
                    class="signature-placeholder small text-muted d-flex align-items-center justify-content-center h-100"
                  >
                    點擊簽名
                  </div>
                  }
                </div>
              </div>
              <!-- 收工前簽名 -->
              <div
                style="width: 25%"
                class="d-flex flex-column align-items-center justify-content-center border-end border-dark py-2 px-1"
              >
                <div class="mb-2 fw-bold small">巡檢人員簽名</div>
                <div
                  class="border signature-area w-100 text-center"
                  (click)="openSignatureDialog(SignatureType.AfterWork)"
                  style="height: 60px; cursor: pointer"
                >
                  @if (afterWorkSignature) {
                  <img
                    [src]="afterWorkSignature"
                    alt="收工前巡檢人員簽名"
                    class="signature-image"
                    style="max-height: 58px"
                  />
                  } @else {
                  <div
                    class="signature-placeholder small text-muted d-flex align-items-center justify-content-center h-100"
                  >
                    點擊簽名
                  </div>
                  }
                </div>
              </div>
              <!-- 監工單位簽名 -->
              <div
                style="width: 25%"
                class="d-flex flex-column align-items-center justify-content-center py-2 px-1"
              >
                <div class="mb-2 fw-bold small">巡檢人員簽名</div>
                <div
                  class="border signature-area w-100 text-center"
                  (click)="openSignatureDialog(SignatureType.SiteManager)"
                  style="height: 60px; cursor: pointer"
                >
                  @if (siteManagerSignature) {
                  <img
                    [src]="siteManagerSignature"
                    alt="監工單位巡檢人員簽名"
                    class="signature-image"
                    style="max-height: 58px"
                  />
                  } @else {
                  <div
                    class="signature-placeholder small text-muted d-flex align-items-center justify-content-center h-100"
                  >
                    點擊簽名
                  </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 備註說明 -->
        <div class="text-start mt-2 mb-3">
          <small class="text-muted"
            >※主承攬商監工人員施工前/中/收工前各項巡檢一次，監工單位(監工人)施工天至少巡檢一次。</small
          >
        </div>

        <!-- 表單編號 -->
        <div class="text-end mb-3">
          <small class="text-muted">EE-4411-15A</small>
        </div>

        <!-- 按鈕區域（工人簽名模式不顯示） -->
        @if (!isWorkerSigningMode) {
        <div class="d-flex mt-4 pt-3">
          <button
            type="button"
            class="btn btn-outline-secondary px-4"
            (click)="cancel()"
          >
            <i class="fas fa-times-circle me-1"></i>取消
          </button>
          
          @if (meetingData._id) {
          <div class="mx-auto d-flex gap-2">
            <button type="button" class="btn btn-info px-4" (click)="showQrCodeModal()">
              <i class="fas fa-qr-code me-1"></i>顯示 QR Code
            </button>
            <button
              type="button"
              class="btn btn-success px-4"
              (click)="generateDocx()"
              [disabled]="isGeneratingPdf"
            >
              @if (isGeneratingPdf) {
                <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                生成中...
              } @else {
                <i class="fas fa-file-word me-1"></i>下載Word
              }
            </button>
          </div>
          }
          
          <div class="ms-auto">
            <button
              type="button"
              class="btn btn-primary px-4"
              (click)="saveMeeting()"
            >
              <i class="fas fa-save me-1"></i>儲存
            </button>
          </div>
        </div>
        }
      </form>
      
      <!-- QR Code Modal -->
      <div
        class="modal fade"
        id="qrCodeModal"
        tabindex="-1"
        aria-labelledby="qrCodeModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="qrCodeModalLabel">
                <i class="fas fa-qr-code me-2"></i>
                工具箱會議 QR Code
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="關閉"></button>
            </div>
            <div class="modal-body text-center">
              <div class="mb-3">
                <h6 class="text-muted">請與會人員掃描後簽名。</h6>
              </div>
              @if (formQrCodeUrl) {
              <div class="d-flex justify-content-center mb-4">
                <div class="border rounded p-3 bg-light">
                  <qrcode [qrdata]="formQrCodeUrl" [width]="256" [errorCorrectionLevel]="'M'" [elementType]="'canvas'" [margin]="4"></qrcode>
                </div>
              </div>
              } @else {
              <div class="text-center">
                <p class="text-muted">QR Code 載入中...</p>
              </div>
              }
              @if (formQrCodeUrl) {
              <div class="mb-3">
                <div class="input-group">
                  <input 
                    type="text" 
                    class="form-control text-center" 
                    [value]="formQrCodeUrl" 
                    readonly
                    #urlInput
                  >
                  <button 
                    class="btn btn-outline-secondary" 
                    type="button"
                    (click)="copyUrl(urlInput)"
                  >
                    <i class="fas fa-copy"></i>
                    複製
                  </button>
                </div>
              </div>
              }
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                掃描後將導向免登入簽名頁面。
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>

<!-- 工人身份驗證 Modal -->
<div
  class="modal fade"
  id="workerVerificationModal"
  tabindex="-1"
  aria-labelledby="workerVerificationModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="workerVerificationModalLabel">
          工人身份驗證
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="關閉"
        ></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="verificationId" class="form-label"
            >請輸入身份證號碼或手機號碼</label
          >
          <input
            type="text"
            class="form-control"
            id="verificationId"
            [(ngModel)]="verificationIdOrPhone"
            placeholder="身份證號碼或手機號碼"
          />
        </div>
        @if (verificationError) {
        <div class="alert alert-danger">{{ verificationError }}</div>
        }
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          取消
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="verifyWorker()"
        >
          驗證
        </button>
      </div>
    </div>
  </div>
</div>
